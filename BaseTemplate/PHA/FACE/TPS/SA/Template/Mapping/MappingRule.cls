Class PHA.FACE.TPS.SA.Template.Mapping.MappingRule Extends %RegisteredObject
{

/// =====================================================
/// Source
/// -----------------------------------------------------
/// SA 侧传入字段名
/// - 对应 Document.Items 中的属性名
/// - Const 类型规则可为空
/// =====================================================
Property Source As %String;

/// =====================================================
/// Target
/// -----------------------------------------------------
/// HIS 侧目标字段路径
/// - 支持多级路径： a.b.c
/// - 由 MappingEngine 负责解析与写入
/// =====================================================
Property Target As %String;

/// =====================================================
/// Scope
/// -----------------------------------------------------
/// 规则作用域
/// - Main : 单据头
/// - Row  : 明细行
/// =====================================================
Property Scope As %String;

/// =====================================================
/// RuleType
/// -----------------------------------------------------
/// 映射规则语义类型
/// - Field : 普通字段直赋值
/// - Dict  : 字典映射（SA Code → HIS ID）
/// - Enum  : 枚举映射（描述 → 固定编码）
/// - Const : 常量赋值
/// =====================================================
Property RuleType As %String;

/// =====================================================
/// Resolver
/// -----------------------------------------------------
/// Resolver 类的完全限定名
/// - 必须实现 ClassMethod Resolve(value, params)
/// - MappingEngine 只认 Resolver，不认 RuleType
/// =====================================================
Property Resolver As %String;

/// =====================================================
/// Params
/// -----------------------------------------------------
/// 规则扩展参数
/// - Dict  : { "dictType": "HIS_VENDOR" }
/// - Enum  : { "enumType": "INREC_TYPE" }
/// - Const : { "value": "2" }
/// =====================================================
Property Params As %DynamicObject;

/// 此映射规则的返回值是否允许为空
Property NullAble As %Boolean;

/// =====================================================
/// %OnNew
/// -----------------------------------------------------
/// 初始化 Params 容器，避免运行期空引用
/// =====================================================
Method %OnNew() As %Status
{
    Set ..Params = ##class(%DynamicObject).%New()
    Set ..NullAble = $$$NO
    Quit $$$OK
}

}
